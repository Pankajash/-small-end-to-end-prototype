<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Pickabook – Character Personaliser</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Simple React setup via CDN for demo purposes -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f5f7fb;
      }
      .page {
        max-width: 960px;
        margin: 0 auto;
        padding: 32px 16px 64px;
      }
      .card {
        background: #ffffff;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      }
      h1 {
        font-size: 24px;
        margin: 0 0 4px;
      }
      .subtitle {
        margin: 0;
        color: #64748b;
        font-size: 14px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 24px;
        margin-top: 24px;
      }
      .upload-box {
        border: 1px dashed #cbd5f5;
        border-radius: 12px;
        padding: 18px;
        background: #f8fafc;
      }
      label {
        display: block;
        font-size: 13px;
        margin-bottom: 8px;
        font-weight: 500;
        color: #334155;
      }
      input[type="file"] {
        width: 100%;
        font-size: 13px;
      }
      button {
        margin-top: 16px;
        padding: 10px 18px;
        border-radius: 999px;
        border: none;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(135deg, #6366f1, #ec4899);
        color: white;
        box-shadow: 0 10px 18px rgba(79, 70, 229, 0.25);
      }
      button:disabled {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
      }
      .status {
        margin-top: 10px;
        font-size: 13px;
        color: #64748b;
      }
      .image-frame {
        border-radius: 16px;
        overflow: hidden;
        background: #e2e8f0;
        min-height: 260px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .image-frame img {
        max-width: 100%;
        max-height: 360px;
        display: block;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(56, 189, 248, 0.1);
        color: #0ea5e9;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }
      .badge-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
      }
      footer {
        margin-top: 24px;
        font-size: 11px;
        color: #94a3b8;
        text-align: center;
      }
      code {
        background: #e2e8f0;
        border-radius: 4px;
        padding: 2px 4px;
        font-size: 11px;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const API_URL = "http://localhost:8000/api/personalize";

      function App() {
        const [file, setFile] = React.useState(null);
        const [status, setStatus] = React.useState("");
        const [loading, setLoading] = React.useState(false);
        const [result, setResult] = React.useState(null);

        const handleFileChange = (event) => {
          const selected = event.target.files && event.target.files[0];
          if (!selected) return;
          setFile(selected);
          setResult(null);
        };

        const handleSubmit = async () => {
          if (!file) {
            setStatus("Please choose a child photo first.");
            return;
          }

          setStatus("Uploading image and running personalisation pipeline...");
          setLoading(true);
          setResult(null);

          try {
            const formData = new FormData();
            formData.append("photo", file);

            const response = await fetch(API_URL, {
              method: "POST",
              body: formData,
            });

            if (!response.ok) {
              const text = await response.text();
              throw new Error(text || "Request failed");
            }

            const data = await response.json();
            setResult(`data:image/png;base64,${data.image_base64}`);
            setStatus("Done! Scroll to see the personalised illustration.");
          } catch (error) {
            console.error(error);
            setStatus("Something went wrong. Check the backend logs.");
          } finally {
            setLoading(false);
          }
        };

        return (
          <div className="page">
            <div className="card">
              <div className="badge">
                <span className="badge-dot"></span>
                Pickabook · Demo Prototype
              </div>
              <h1>Story Illustration Personaliser</h1>
              <p className="subtitle">
                Upload a child&apos;s photo and preview how the illustration is automatically
                adapted to their face.
              </p>

              <div className="grid">
                <div className="upload-box">
                  <label htmlFor="photo">Child&apos;s photo (face clearly visible)</label>
                  <input
                    id="photo"
                    type="file"
                    accept="image/*"
                    onChange={handleFileChange}
                  />
                  <button onClick={handleSubmit} disabled={loading}>
                    {loading ? "Personalising..." : "Generate Illustration"}
                  </button>
                  <div className="status">
                    {status || "Backend: FastAPI · Model: Instant-ID style pipeline (mocked)."}
                  </div>
                  <p style={{ fontSize: 11, marginTop: 10 }}>
                    Make sure the FastAPI backend is running on{" "}
                    <code>localhost:8000</code> before testing.
                  </p>
                </div>

                <div className="image-frame">
                  {result ? (
                    <img src={result} alt="Personalised illustration" />
                  ) : (
                    <p style={{ fontSize: 13, color: "#64748b", textAlign: "center", padding: 16 }}>
                      The generated illustration will appear here after you upload a photo.
                    </p>
                  )}
                </div>
              </div>
            </div>
            <footer>
              Prototype built for the Pickabook technical assignment – single-user demo only.
            </footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
